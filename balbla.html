<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chatbot con Dialogflow</title>
</head>
<body>
  <div id="messages"></div>
  <input type="text" id="user-input" placeholder="Escribe tu mensaje...">
  <button id="send-btn">Enviar</button>

  <script>
    document.getElementById('send-btn').addEventListener('click', sendMessage);

    async function sendMessage() {
      const userInput = document.getElementById('user-input').value.trim();
      if (userInput === '') return;

      // Mostrar el mensaje del usuario
      addMessage(userInput, 'user');

      // Obtener respuesta del bot
      await getBotResponse(userInput);
      document.getElementById('user-input').value = ''; // Limpiar el input
    }

    function addMessage(message, sender) {
      const messagesDiv = document.getElementById('messages');
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${sender}`;
      messageDiv.textContent = message;
      messagesDiv.appendChild(messageDiv);

      // Desplazar hacia abajo automáticamente
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    async function getBotResponse(userInput) {
      const apiUrl = 'https://dialogflow.cloud.google.com/cx/projects/hardy-thinker-448603-q9/locations/us-central1/agents/b299765f-8403-4cb6-b0d9-48dcd08295ad';
      const apiKey = 'AIzaSyANb-3JWKBgTpLLSA5-iTSfM5Q0fRGuv2o';  // Aquí va tu API Key de Dialogflow

      const body = {
        queryInput: {
          text: {
            text: userInput,
            
            languageCode: 'es',  // Idioma en el que se quiere que el bot responda
          },
        },
      };

      try {
        const response = await fetch(`${apiUrl}?key=${apiKey}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(body),
        });

        const data = await response.json();
        const botResponse = data.queryResult.fulfillmentText;
        addMessage(botResponse, 'bot');
      } catch (error) {
        console.error('Error al obtener la respuesta del bot:', error);
      }
    }
  </script>
</body>
</html>
